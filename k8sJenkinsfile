#!/usr/bin/env groovy
// pipeline {
//     agent {
//         kubernetes {
//             containerTemplate {
//                 name 'helm'
//                 image 'lachlanevenson/k8s-helm:v3.1.1'
//                 ttyEnabled true
//                 command 'cat'
//             }
//         }
//     }

//     stages {
//         stage('Deploy Streaming') {
//             steps {
//                 container('helm') { 
//                     sh "helm version"
//                 } 
//             }
//         }
//     }
// }

// podTemplate(containers: [
//     // containerTemplate(name: 'k8s-helm', image: 'lachlanevenson/k8s-helm:latest'),
//     containerTemplate(name: 'busybox', image: 'busybox'),
//   ]) {

//     node(POD_LABEL) {
//         // stage('Helm slave test') {
//         //     container('k8s-helm') {
//         //         stage('Helm Version') {
//         //             sh 'helm version'
//         //         }
//         //     }
//         // }
//         stage('Busybox') {
//             container('busybox') {
//                 stage('busy box test') {
//                     sh 'echo "Hello Busybox"'
//                 }
//             }
//         }
//     }
// }

podTemplate(label: 'jenkins-slave', containers: [
    containerTemplate(name: 'maven', image: 'maven:3.8.1-jdk-8', command: 'sleep', args: '99d'),
  ]) {
    node() {
        stage('jnlp test') {
            sh 'echo hello world'
        }

        stage('Get a Maven project') {
            git 'https://github.com/jenkinsci/kubernetes-plugin.git'
            container('maven') {
                stage('Build a Maven project') {
                    sh 'mvn -B -ntp clean install'
                }
            }
        }
    }
}